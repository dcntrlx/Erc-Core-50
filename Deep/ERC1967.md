# ERC1967
**Created**: 2019-04-24  
**Link to the standard**: [ERC1967](https://eips.ethereum.org/EIPS/eip-1967)  
**Description**: 
- Strandardize where proxy information is stored and prevents storage clashes between the Proxy and the Logic contract.(Previously every single project chose its own storage slots for proxy info, that lead to clashed)

**Motivation**: 
ERC-1967 defines specic slots for storing proxy information to prevent storage clashes between Proxy and logic contract and to provide predictable information where implementation, admin and beacon are stored for convience

### Specification: The Standard Slots

The standard defines three specific storage slots. They are calculated as `bytes32(uint256(keccak256('eip1967.proxy.X')) - 1)`.

#### 1. Logic Contract Address (Implementation)
*   **Slot**: `bytes32(uint256(keccak256('eip1967.proxy.implementation')) - 1)` = `0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc`
*   **Purpose**: Holds the address of the logic contract the proxy delegates to.
*   **Event**: `event Upgraded(address indexed implementation);`

#### 2. Beacon Contract Address
*   **Slot**: `bytes32(uint256(keccak256('eip1967.proxy.beacon')) - 1)` = `0xa3f0ad74e5423aebfd80d3ef4346578335a9a72aeaee59ff6cb3582b35133d50`
*   **Purpose**: Holds the address of the Beacon contract (if using Beacon Proxy pattern).
*   **Event**: `event BeaconUpgraded(address indexed beacon);`

#### 3. Admin Address
*   **Slot**: `bytes32(uint256(keccak256('eip1967.proxy.admin')) - 1)` = `0xb53127684a568b3173ae13b9f8a6016e243e63b6e8ee1178d6a717850b5d6103`
*   **Purpose**: Holds the address alowed to upgrade the proxy (optional).
*   **Event**: `event AdminChanged(address previousAdmin, address newAdmin);`

### Those specified addresses allows to:
1.  **Avoid Clashes**: The slots are extremely high numbers (near `2^256`). Solidity allocates storage starting from `slot 0` and increments. It is statistically impossible for a normal contract to reach these slots.
2.  **Preimage Protection**: The `- 1` in the formula ensures the preimage is unknown. This prevents attacks where someone tries to craft a mapping key that collides with this slot.
    *   *Without -1*: Attacker knows the input (`"eip1967..."`). Finding a collision is a **Second Preimage Attack** (Hard, but they have a starting point).
    *   *With -1*: Attacker knows **no input**. Finding a collision is a **Preimage Attack** (Harder, they are flying blind).

### Implementation Example (OpenZeppelin Style)

```solidity
library StorageSlot {
    struct AddressSlot { address value; }

    function getAddressSlot(bytes32 slot) internal pure returns (AddressSlot storage r) {
        assembly { r.slot := slot }
    }
}

contract ERC1967Upgrade {
    bytes32 internal constant _IMPLEMENTATION_SLOT = 0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc;

    function _getImplementation() internal view returns (address) {
        return StorageSlot.getAddressSlot(_IMPLEMENTATION_SLOT).value;
    }

    function _setImplementation(address newImplementation) private {
        StorageSlot.getAddressSlot(_IMPLEMENTATION_SLOT).value = newImplementation;
    }
}
```