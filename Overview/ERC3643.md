# ERC3643
Created: 2021-07

Description: ERC3643 is the TREX (Token for Regulated EXchanges) standard. An institutional-grade security token standard that provides interfaces for the management and compliant transfer of security tokens. It uses an automated on-chain validator system leveraging on-chain identities (ONCHAINID) for eligibility checks.

## Core Components

### 1. Token
ERC-20 compatible but with conditional transfers.
- `transfer` and `transferFrom` are overridden to check `isVerified` and `canTransfer` before execution.
- Supports minting, burning, pausing, and freezing (partial or total).
- Supports recovery of lost tokens (if private key is lost).

### 2. Identity Registry
A dynamic whitelist of identities.
- Links a wallet address to an **Identity Smart Contract** 
- `isVerified(address)`: Checks if the user has valid claims (KYC/AML, etc) required by the token.
- Managed by agents (issuers).

### 3. Compliance
Sets the rules of the offering.
- `canTransfer(from, to, amount)`: Checks if a transfer respects all rules (e.g., max investors per country, max tokens per investor).
- Can be "tailor-made" or modular (plug-and-play rules).
- Triggered at every transaction.

### 4. Trusted Issuers Registry
Stores the list of trusted Claim Issuers whose signed attestations are accepted by the token.

### Transfer 
1. User calls `transfer(to, amount)`.
2. Token calls `IdentityRegistry.isVerified(to)` to ensure receiver is eligible.
3. Token calls `Compliance.canTransfer(from, to, amount)` to ensure global rules are met.
4. If both pass, the transfer executes.

### Recovery 
1. Investor loses private key.
2. Agent (Issuer) calls `recoveryAddress(lostWallet, newWallet, onchainID)`.
3. Tokens are moved to the new wallet.
4. Old wallet is removed from Identity Registry; new wallet is added.

## Interfaces

### Token Interface (Partial)
```solidity
interface IERC3643 is IERC20 {
    // Getters
    function identityRegistry() external view returns (IIdentityRegistry);
    function compliance() external view returns (ICompliance);
    function isFrozen(address _userAddress) external view returns (bool);
    
    // Setters (Agent only)
    function setIdentityRegistry(address _identityRegistry) external;
    function setCompliance(address _compliance) external;
    function freezePartialTokens(address _userAddress, uint256 _amount) external;
    function unfreezePartialTokens(address _userAddress, uint256 _amount) external;
    function pause() external;
    function unpause() external;

    // Actions
    function forcedTransfer(address _from, address _to, uint256 _amount) external returns (bool);
    function mint(address _to, uint256 _amount) external;
    function burn(address _userAddress, uint256 _amount) external;
    function recoveryAddress(address _lostWallet, address _newWallet, address _investorOnchainID) external returns (bool);
}
```

### Identity Registry Interface
```solidity
interface IIdentityRegistry {
    function isVerified(address _userAddress) external view returns (bool);
    function registerIdentity(address _userAddress, IIdentity _identity, uint16 _country) external;
    function deleteIdentity(address _userAddress) external;
}
```

### Compliance Interface
```solidity
interface ICompliance {
    function canTransfer(address _from, address _to, uint256 _amount) external view returns (bool);
    function transferred(address _from, address _to, uint256 _amount) external;
    function created(address _to, uint256 _amount) external;
    function destroyed(address _from, uint256 _amount) external;
}
```

