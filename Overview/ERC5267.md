# ERC5267

Created: 2022-07
Description: A standard for retrieving the EIP-712 domain used by a contract, enabling secure and scalable integration of signatures by wallets and applications.

## Core Concepts

### The Problem: Opaque Domains
EIP-712 signatures require a Domain Separator to prevent replay attacks and provide context. However, contracts often only expose the final hash of this domain (via DOMAIN_SEPARATOR()). Wallets need the full structure (name, version, chainId, etc.) to display a human-readable Sign Typed Data prompt. Without this, integrations are manual and fragile.

### The Solution: Introspection
ERC-5267 adds an eip712Domain() function that returns the components of the domain, not just the hash.
1. Retrieve: A wallet calls eip712Domain() to get the specific fields (name, version, chainId, etc.) used by the contract.
2. Reconstruct: The wallet reconstructs the domain object.
3. Verify: The wallet verifies that the reconstructed domain matches the contract's DOMAIN_SEPARATOR.
4. Display: The wallet shows the user exactly what domain they are signing for.

Result: Automatic Integration for any EIP-712 contract.

## Methods

### eip712Domain
```solidity
function eip712Domain() external view returns (
    bytes1 fields,
    string name,
    string version,
    uint256 chainId,
    address verifyingContract,
    bytes32 salt,
    uint256[] extensions
);
```
fields: A bitmap indicating which fields are present in the domain.
name: The user-readable name of the signing domain.
version: The major version of the signing domain.
chainId: The EIP-155 chain ID.
verifyingContract: The address of the contract verifying the signature.
salt: A disambiguating salt.
extensions: A list of EIP numbers for any domain extensions used.

### EIP712DomainChanged
```solidity
event EIP712DomainChanged();
```
Emitted when the domain parameters change (e.g., after a hard fork or upgrade).

## Implementation Details

### The Fields Bitmap
The fields byte is a bitmap where each bit corresponds to a standard EIP-712 field.
Bit 0: name
Bit 1: version
Bit 2: chainId
Bit 3: verifyingContract
Bit 4: salt

Example: 0x0d (binary 01101) means name (Bit 0), chainId (Bit 2), and verifyingContract (Bit 3) are present.

### Verification Logic
A client integrating with an ERC-5267 contract performs the following:
1. Call eip712Domain().
2. Parse fields to determine which returned values are valid.
3. Construct the EIP-712 domain JSON object.
4. Hash this object to calculate the DOMAIN_SEPARATOR.
5. Compare with the contract's actual DOMAIN_SEPARATOR (if exposed) or use it to generate signatures.

## Nuance & Risks
1. Bit Ordering: Bits are read from least significant to most significant. Bit 0 is the rightmost bit.
2. Unused Fields: All return values must be provided even if the bit is 0 (usually as empty strings or zero values).
3. Mutability: Domains can change (e.g., if chainId changes after a fork). The EIP712DomainChanged event signals this, and clients should re-fetch the domain.

## Summary Comparison
EIP-712 (Base): Defines how to sign data but not how to discover the domain parameters.
ERC-5267: Standardizes the discovery of those parameters, enabling generic wallet support.
