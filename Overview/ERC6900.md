# ERC6900
Created: 2023-04
Description: A standard for Modular Smart Contract Accounts (MSCA) that allows composable logic (plugins) for validation, execution, and hooks, built on top of ERC-4337.

## Core Concepts
-   **ERC-4337**: Standardizes the transaction pipeline (Mempool -> Bundler -> Account).
-   **ERC-6900**: Standardizes the account internal architecture (Account <-> Modules).

ERC-6900 defines a standard interface for accounts to install and manage Modules.
1.  Validation Modules: Define who can sign transactions
2.  Execution Modules: Define what the account can do
3.  Hooks: Logic that runs before or after execution

## Methods

### Module Management
```solidity
function installModule(uint256 moduleType, address module, bytes calldata initData) external payable;
function uninstallModule(uint256 moduleType, address module, bytes calldata deinitData) external payable;
```
-   installModule: Adds a new capability to the account.
-   moduleType: Identifies if it's a Validator, Executor, or Hook.

### Execution
```solidity
function executeUserOp(PackedUserOperation calldata userOp, bytes32 userOpHash) external payable;
function executeFromExecutor(address target, uint256 value, bytes calldata data) external payable returns (bytes memory);
```
-   executeUserOp: The entry point for ERC-4337 bundlers.
-   executeFromExecutor: Allows an installed Execution Module to trigger actions on the account's behalf.

## Implementation Details

### The Diamond-like Pattern
ERC-6900 accounts often use a fallback handler similar to Diamonds (ERC-2535).
-   If a function selector is not found in the main account, the account checks installed Execution Modules.
-   If a match is found, it `delegatecall`s to the module.
-   This allows the account to gain new methods (e.g., `borrow()`) dynamically.

### Validation Flow
When a UserOp arrives:
1.  Pre-Validation Hooks: Check global rules (e.g., "Is the account paused?").
2.  Validation Module: Checks the signature (e.g., "Is this a valid Passkey signature?").
3.  Pre-Execution Hooks: Check transaction specific rules (e.g., "Is this transfer under the daily limit?").
4.  Execution: Perform the action.
5.  Post-Execution Hooks: Update state (e.g., "Increment daily spend counter").