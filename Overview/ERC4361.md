# ERC4361
Created: 2021-10
Description: A standard for "Sign-In with Ethereum" (SIWE), defining a specific message format for off-chain authentication.

## Core Concepts
### The Solution Structured Message
ERC-4361 defines a strict ABNF grammar for the message to be signed.
-   **Domain Binding**: The message MUST include the domain (e.g `example.com`) requesting the login.
-   **Nonce**: A random string to prevent replay attacks.
-   **Chain ID**: Prevents cross-chain replay.
-   **Human Readable**: The message is plain text, starting with "example.com wants you to sign in with your Ethereum account:".

## Methods

### Message Format
```text
${domain} wants you to sign in with your Ethereum account:
${address}

${statement}

URI: ${uri}
Version: ${version}
Chain ID: ${chain-id}
Nonce: ${nonce}
Issued At: ${issued-at}
Expiration Time: ${expiration-time}
Not Before: ${not-before}
Request ID: ${request-id}
Resources:
- ${resources[0]}
- ${resources[1]}
```

### Verification
1.  **Check Domain**: The server verifies the message domain matches the host.
2.  **Check Nonce**: The server verifies the nonce matches the session.
3.  **Verify Signature**:
    -   **EOA**: Use `ecrecover` (standard ECDSA).
    -   **Smart Contract**: Use ERC-1271 `isValidSignature`.

## Implementation Details

### Wallet Support
Wallets (Metamask, Rainbow, etc.) can detect this specific message format. Instead of showing a raw text block, they can show a friendly UI:
"**Login Request** from **example.com**"

### Security
-   **Phishing**: By binding the message to the domain, a phishing site at `evil.com` cannot ask you to sign a valid login message for `bank.com`.
-   **Replay**: The nonce ensures that a captured signature cannot be used again later.

## Risks
1.  **Text-Based**: Implementations must be strict about whitespace and newlines to match the spec exactly because standart uses messages base on text.

