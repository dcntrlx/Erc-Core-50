# ERC5805
Created: 2022-09
Description: A standard interface for voting weight tracking and delegation, formalizing the governance mechanisms popularized by Compound-style tokens.

## Core Concepts
ERC-5805 extends token functionality to track "Voting Power" separately from "Token Balance".
1.  Checkpoints: The contract records the voting power history. 
2.  Delegation: Token holders can assign their voting power to a "Delegate" without transferring the actual tokens.

## Methods

### Voting Weight
```solidity
function getVotes(address account) external view returns (uint256);
function getPastVotes(address account, uint256 timepoint) external view returns (uint256);
```
-   getVotes: Returns the current voting power of an account.
-   getPastVotes: Returns the voting power at a specific point in the past. This is the critical function for governance proposals.

### Delegation
```solidity
function delegates(address account) external view returns (address);
function delegate(address delegatee) external;
function delegateBySig(address delegatee, uint256 nonce, uint256 expiry, uint8 v, bytes32 r, bytes32 s) external;
```
-   delegate: The caller assigns their voting power to `delegatee`.
-   delegateBySig: Allows a user to delegate via an off-chain signature (gasless for the user).

## Implementation Details

### The Clock
ERC-5805 relies on ERC-6372 to define the "Clock".
-   The `timepoint` used in `getPastVotes` can be a Block Number or a Timestamp.
-   Block Number is traditional for Ethereum L1.
-   Timestamp is often preferred for L2s where block times vary or are extremely fast.

### Move Semantics
When tokens are transferred (ERC-20 `transfer`), the token contract must automatically update the voting power of the delegates.
1.  Alice delegates to Bob.
2.  Alice receives 100 tokens.
3.  The contract updates Alice's balance (+100).
4.  The contract updates Bob's voting power (+100) and writes a new checkpoint.

### Checkpoint Mechanics
1.  Storage: `mapping(address => Checkpoint[])`. Each checkpoint is a struct `{uint48 timepoint, uint208 votes}`.
2.  Write (O(1)):
    -   If the last checkpoint is from the current block, update it (overwrite).
    -   If it's from an older block, push a new checkpoint to the array.
3.  Read (O(log n)): `getPastVotes` uses Binary Search to find the closest checkpoint before or at the requested timepoint.

## Nuance & Risks
1.  Gas Overhead: Every token transfer involves writing checkpoints for the delegates. This makes ERC-5805 tokens more expensive to transfer than plain ERC-20 tokens.
2.  Delegation to Zero: Delegating to `address(0)` disables checkpointing, saving gas for users who do not care about governance.
3.  Write Amplification: If many users delegate to one person (a "Whale Delegate"), sending tokens to that Whale does not cost extra gas. However, if the Whale sends tokens, they might be moving tokens owned by themselves (delegated to themselves), triggering a checkpoint update.

## Summary Comparison
-   ERC-20: Tracks who holds the tokens.
-   ERC-5805: Tracks who controls the votes (history + delegation).
