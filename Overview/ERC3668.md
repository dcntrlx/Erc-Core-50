# [ERC3668](https://eips.ethereum.org/EIPS/eip-3668)
**Created:** 2020-07-21

**Description:** A standard that allows smart contracts to fetch data from offchain sources. This enables contracts to access large datasets or expensive-to-compute information without storing it all onchain, while maintaining cryptographic security.

### Overview
The protocol works by "optimistic" execution. When a contract needs data it doesn't have, it reverts the current execution (stopping it completely). This revert returns a specific error telling the caller (wallet or dApp) where to find the data.

The caller then fetches the data offchain and initiates a new call to the contract, passing the fetched data as an argument. The contract then runs its validation logic in this new call.

### Error Definition
The core of the standard is a specific error that signals a request for offchain data.

1.  **`OffchainLookup`**
    ```solidity
    error OffchainLookup(
        address sender,
        string[] urls,
        bytes callData,
        bytes4 callbackFunction,
        bytes extraData
    )
    ```
    - **sender**: The address of the contract initiating the lookup.
    - **urls**: A list of HTTP endpoints where the client can query the data.
    - **callData**: The query data to send to the gateway (usually encoded).
    - **callbackFunction**: The 4-byte selector of the function the client should call with the result.
    - **extraData**: Contextual data the contract needs to preserve for the callback (passed back unchanged).

### Client Protocol
When a client (like a wallet) simulates a transaction and catches an `OffchainLookup` error, it follows these steps:

1.  **Select Gateway**: Pick a URL from the urls list.
2.  **Query**: Send the callData to the gateway.
    - If the URL includes {data}, replace it with the hex-encoded callData (GET request).
    - Otherwise, send a POST request with {"data": "..."} JSON body.
3.  **Receive**: Get the response data from the gateway.
4.  **Callback**: Call the function specified by callbackFunction on the sender contract.
    - The arguments will be (response, extraData).
    - The response is the data from the gateway.
    - The extraData is the original context bytes from the error.

### Verification
The contract must implement the callbackFunction to validate the data. Since the data comes from an offchain source, it cannot be trusted blindly.

Common verification strategies include:
-   **Signatures**: Checking if the data is signed by a trusted key (e.g., an oracle).
-   **Merkle Proofs**: Verifying that the data is part of a larger dataset committed to onchain (e.g., a state root).

If the validation fails, the callback function should revert, causing the entire transaction to fail.

### This can be used for different systems:
-   **ENS (Ethereum Name Service)**: Storing domain records on Layer 2 or centralized servers to reduce gas costs.
-   **Allowlists**: Checking if a user is eligible for a mint using a Merkle tree stored offchain.
-   **Token Governance**: Voting with signatures stored offchain, submitting only the result onchain.
