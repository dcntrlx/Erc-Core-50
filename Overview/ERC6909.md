# ERC6909
**Created**: 2023-05-08
**Link to the standard**: [ERC6909](https://eips.ethereum.org/EIPS/eip-6909)

**Description**:
ERC-6909 is a "Minimal Multi-Token Interface" designed specifically for high-performance protocols. Ideally, it allows a single contract to manage multiple token types, similar to ERC-1155, but it strips away the "luxury" features to maximize gas efficiency. You can think of it like this: if ERC-1155 is a safe, heavy "Bus" with many mandatory stops, ERC-6909 is a stripped-down "Race Car" built for raw speed that assumes a skilled driver.

**Motivation**:
The main goal is to solve the "bloat" issue found in ERC-1155. Features like mandatory callbacks and batch operations, while useful for general users, incur unnecessary gas costs for advanced protocols that don't need those safety rails.

### The Core Problem
Before this standard, protocols that managed thousands of tokens—like gaming items or liquidity pools—had to rely on ERC-1155. This was inefficient because every transfer forced a check to see if the recipient could receive tokens (safe for users, but expensive for protocols), and the mandatory support for batch operations added complexity and gas overhead even when unused. ERC-6909 solves this by removing these mandates, prioritizing raw efficiency over safety.

### Key Technical Features
First, it handles **Multi-Token Management** just like ERC-1155, where a single contract can manage an infinite number of token IDs.

Second, it removes **Mandatory Callbacks**, meaning transfers are simple ledger updates. If you send tokens to a contract that can't handle them, they are simply lost, which is the trade-off for efficiency.

Finally, it offers a **Hybrid Approval Model**. You can use ERC-20 style approvals (specific amount for a specific ID) or ERC-1155 style operators (move all tokens of all IDs).
    -   **ERC-6909 supports BOTH**: It combines these mechanisms, giving you fine-grained control to choose the method that fits best.
    > There is no specific `setOperatorForId` function. To approve an operator for one specific token ID (similar to ERC-721), you simply use `approve(spender, id, type(uint256).max)`. Adding a separate function for this would be redundant and violate the "Minimal" design philosophy.
    
## Core Interface
A contract that is compliant with ERC-6909 shall implement the following interface:

```solidity
interface IERC6909 {
    // Events
    event Transfer(address indexed caller, address indexed sender, address indexed receiver, uint256 id, uint256 amount);
    event OperatorSet(address indexed owner, address indexed spender, bool approved);
    event Approval(address indexed owner, address indexed spender, uint256 indexed id, uint256 amount);

    // Functions
    function balanceOf(address owner, uint256 id) external view returns (uint256 amount);
    function allowance(address owner, address spender, uint256 id) external view returns (uint256 amount);
    function isOperator(address owner, address spender) external view returns (bool approved);

    function transfer(address receiver, uint256 id, uint256 amount) external returns (bool);
    function transferFrom(address sender, address receiver, uint256 id, uint256 amount) external returns (bool);
    
    function approve(address spender, uint256 id, uint256 amount) external returns (bool);  // Aproves an allowance over single token id
    function setOperator(address spender, bool approved) external returns (bool);  // Aproves an operator to move all tokens of owner
    
    // ERC-165
    function supportsInterface(bytes4 interfaceId) external view returns (bool);
}
```

## Use Cases

Uniswap v4 is the most famous implementation, using ERC-6909 for its Singleton architecture. Instead of moving ERC-20 tokens constantly between pools, trades simply update internal ERC-6909 balances ("Flash Accounting").

1.  Minting (Deposit): When a user deposits assets (like USDC or ETH) into the pool, the Singleton mints them a corresponding amount of ERC-6909 tokens representing their claim on those assets.
2.  Trading: Users swap these ERC-6909 tokens internally. This is cheap because it's just updating numbers in the Singleton's storage.
3.  Burning (Withdrawal): To get the actual underlying assets back to their wallet, the user must burn the ERC-6909 tokens.

This drastically reduces gas by avoiding external calls during intermediate steps.
